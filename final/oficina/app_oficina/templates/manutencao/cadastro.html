{% extends './../pages/base.html' %}
{% block conteudo %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h1 class="text-center">Cadastro de Manutenção</h1>
        </div>
        <div class="card-body">
            <form id="manutencao-form" action="{% url 'c_manutencao' %}" method="post">
                {% csrf_token %}
                <div class="form-group row">
                    <label for="vehicle" class="col-sm-2 col-form-label">Veículo:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="vehicle" name="vehicle" required>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="Km" class="col-sm-2 col-form-label">Km:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="Km" name="Km" required>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="mechanic" class="col-sm-2 col-form-label">Mecânico Responsável:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="mechanic" name="mechanic" required>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="date" class="col-sm-2 col-form-label">Data:</label>
                    <div class="col-sm-10">
                        <input type="date" class="form-control" id="date" name="date" required>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="part" class="col-sm-2 col-form-label">Nome da Peça:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="part" name="part">
                    </div>
                </div>

                <div class="form-group row">
                    <label for="quantity" class="col-sm-2 col-form-label">Quantidade:</label>
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="quantity" name="quantity">
                    </div>
                </div>

                <div class="form-group row">
                    <label for="unitPrice" class="col-sm-2 col-form-label">Preço Unitário:</label>
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="unitPrice" name="unitPrice">
                    </div>
                </div>

                <button type="button" id="add-part" class="btn btn-primary">Adicionar Peça</button>

                <table class="table mt-4">
                    <thead>
                        <tr>
                            <th scope="col">Nome da Peça</th>
                            <th scope="col">Quantidade</th>
                            <th scope="col">Preço Unitário</th>
                            <th scope="col">Preço Total</th>
                        </tr>
                    </thead>
                    <tbody class="part-list"></tbody>
                </table>
                
                <!-- <ul class="list-group part-list"></ul> -->

                <div class="form-group">
                    <label for="comments">Comentários:</label>
                    <textarea class="form-control" id="comments" name="comments" rows="5"></textarea>
                </div>

                <div class="button-group text-center">
                    <button type="submit" class="btn btn-success">Cadastrar</button>
                    <a href="{% url 'home' %}" class="btn btn-danger">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Adiciona um listener para o botão de adicionar peça
    document.getElementById("add-part").addEventListener("click", function() {
        // Obtém os valores dos campos de nome da peça, quantidade e preço unitário
        var partName = document.getElementById("part").value;
        var quantity = document.getElementById("quantity").value;
        var unitPrice = document.getElementById("unitPrice").value;
        
        // Calcula o preço total da peça
        var totalPrice = quantity * unitPrice;
        
        // Cria uma nova linha na tabela para exibir a peça adicionada
        var newRow = document.createElement("tr");
        
        // Cria células para cada coluna da tabela
        var partNameCell = document.createElement("td");
        partNameCell.textContent = partName;
        
        var quantityCell = document.createElement("td");
        quantityCell.textContent = quantity;
        
        var unitPriceCell = document.createElement("td");
        unitPriceCell.textContent = unitPrice;
        
        var totalPriceCell = document.createElement("td");
        totalPriceCell.textContent = totalPrice;
        
        // Adiciona as células à nova linha
        newRow.appendChild(partNameCell);
        newRow.appendChild(quantityCell);
        newRow.appendChild(unitPriceCell);
        newRow.appendChild(totalPriceCell);
        
        // Adiciona a nova linha à tabela
        document.querySelector(".part-list").appendChild(newRow);
        
        // Limpa os campos de nome da peça, quantidade e preço unitário
        document.getElementById("part").value = "";
        document.getElementById("quantity").value = "";
        document.getElementById("unitPrice").value = "";
    });

    // Adiciona um listener para o evento de envio do formulário
    document.getElementById("manutencao-form").addEventListener("submit", function(e) {
        // Obtém a tabela de peças
        var table = document.querySelector(".part-list");

        // Obtém todas as linhas da tabela de peças
        var rows = table.getElementsByTagName("tr");

        // Cria um elemento de input oculto para cada peça e adiciona ao formulário
        for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].getElementsByTagName("td");
            var partName = cells[0].textContent;
            var quantity = cells[1].textContent;
            var unitPrice = cells[2].textContent;

            // Cria um input oculto para o nome da peça
            var inputPartName = document.createElement("input");
            inputPartName.type = "hidden";
            inputPartName.name = "part";
            inputPartName.value = partName;

            // Cria um input oculto para a quantidade
            var inputQuantity = document.createElement("input");
            inputQuantity.type = "hidden";
            inputQuantity.name = "quantity";
            inputQuantity.value = quantity;

            // Cria um input oculto para o preço unitário
            var inputUnitPrice = document.createElement("input");
            inputUnitPrice.type = "hidden";
            inputUnitPrice.name = "unitPrice";
            inputUnitPrice.value = unitPrice;

            // Adiciona os inputs ocultos ao formulário
            document.getElementById("manutencao-form").appendChild(inputPartName);
            document.getElementById("manutencao-form").appendChild(inputQuantity);
            document.getElementById("manutencao-form").appendChild(inputUnitPrice);
        }
    });
</script>
{% endblock %}
